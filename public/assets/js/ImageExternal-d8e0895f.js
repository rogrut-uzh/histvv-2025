import{a as e}from"./_rollupPluginBabelHelpers-56fbbc65.js";import"./es.string.ends-with-e883ac46.js";import{B as t,c as i}from"./ui.mjs";class s extends t{constructor(){super()}init(e){return this.el=e,this.$el=i(e),this.$parent=this.$el.parents(".Image").first(),this.parent=this.$parent[0],this.userDefinedWidth=Number(this.parent.style.getPropertyValue("--image_width")),this.userDefinedHeight=Number(this.parent.style.getPropertyValue("--image_height")),this.userDefinedWidth&&this.userDefinedHeight||(this.el.complete&&this.el.naturalHeight>1?this.setSize():this.one("load",(()=>{this.setSize()}))),this}setSize(){var t=this;return e((function*(){var e,i;if(t.el.src.endsWith("svg")){var{width:s,height:r}=yield t.getNormalizedSVGSize();e=s,i=r}else e=t.el.naturalWidth,i=t.el.naturalHeight;var h=e/i;t.userDefinedWidth?t.parent.style.setProperty("--image_height",t.userDefinedWidth/h):t.userDefinedHeight?t.parent.style.setProperty("--image_width",t.userDefinedHeight*h):(t.parent.style.setProperty("--image_width",e),t.parent.style.setProperty("--image_height",i))}))()}getNormalizedSVGSize(){return new Promise((e=>{var t=new Image;t.style.width="auto",t.style.height="auto",t.style.position="absolute",t.style.visibility="hidden",t.style.pointerEvents="none",document.body.appendChild(t),t.src=this.el.src,t.onload=()=>{var{width:i,height:s}=t;t.remove(),e({width:i,height:s}),this.el.closest(".MasonryGrid")&&window.dispatchEvent(new CustomEvent("masonry:update"))},t.onerror=()=>{t.remove(),e({width:0,height:0})}}))}}export{s as default};
